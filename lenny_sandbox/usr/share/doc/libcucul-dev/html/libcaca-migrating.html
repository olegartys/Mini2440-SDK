<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
    <title>libcaca documentation</title>
    <link href="doxygen.css" rel="stylesheet" type="text/css">
  </head>
  <body>
<!-- $Id$ -->
<!-- Generated by Doxygen 1.5.6 -->
<div class="contents">
<h1><a class="anchor" name="libcaca-migrating">Migrating from libcaca 0.x to the 1.0 API </a></h1>This section will guide you through the migration of a <em>libcaca</em> 0.x application to the latest API version.<h2><a class="anchor" name="foo1">
Overview</a></h2>
The most important changes in the 1.0 API of <em>libcaca</em> are the <em>libcaca</em> / <em>libcucul</em> split and the object-oriented design. See these two examples for a rough idea of what changed:<p>
<table border="0" cellspacing="3" cellpadding="3">
<tr>
<td valign="top"><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="caca_8h.html" title="The libcaca public header.">caca.h</a>&gt;</span>

<span class="comment">/* libcaca program - 0.x API */</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)
{
    <span class="comment">/* Initialise libcaca */</span>
    caca_init();
    <span class="comment">/* Set window title */</span>
    caca_set_window_title(<span class="stringliteral">"Window"</span>);
    <span class="comment">/* Choose drawing colours */</span>
    caca_set_color(CACA_COLOR_BLACK,
                   CACA_COLOR_WHITE);
    <span class="comment">/* Draw a string at (0, 0) */</span>
    caca_putstr(0, 0, <span class="stringliteral">"Hello world!"</span>);
    <span class="comment">/* Refresh display */</span>
    caca_refresh();
    <span class="comment">/* Wait for a key press event */</span>
    caca_wait_event(<a class="code" href="caca_8h.html#40754185ca237fc44a95357afba34aeab1da825755a2ac3593cca73721b77e22">CACA_EVENT_KEY_PRESS</a>);
    <span class="comment">/* Clean up library */</span>
    caca_end();

    <span class="keywordflow">return</span> 0;
}
</pre></div> </td><td><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="cucul_8h.html" title="The libcucul public header.">cucul.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="caca_8h.html" title="The libcaca public header.">caca.h</a>&gt;</span>

<span class="comment">/* libcaca program - 1.0 API */</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)
{
    <span class="comment">/* Initialise libcaca */</span>
    <a class="code" href="cucul_8h.html#0e7a267dbc21f942cc730fecb0f7e095">cucul_canvas_t</a> *cv;
    <a class="code" href="caca_8h.html#da5af7a20f3e2f6c103078181b07393e">caca_display_t</a> *dp;
    dp = <a class="code" href="group__libcaca.html#g6128232026056ca5cd5905a745e9aaed" title="Attach a caca graphical context to a cucul canvas.">caca_create_display</a>(cv);
    cv = <a class="code" href="group__libcaca.html#ge7c9d6ddf41479f28989c935f614e452" title="Get the canvas attached to a caca graphical context.">caca_get_canvas</a>(dp);
    <span class="comment">/* Set window title */</span>
    <a class="code" href="group__libcaca.html#gdab2bf1e8d0bf5c3cfb3e29ab07d5641" title="Set the display title.">caca_set_display_title</a>(dp, <span class="stringliteral">"Window"</span>);
    <span class="comment">/* Choose drawing colours */</span>
    <a class="code" href="group__cucul__canvas.html#gd83c1d480f332db6db3ad249c5cb1749" title="Set the default colour pair for text (ANSI version).">cucul_set_color_ansi</a>(cv, <a class="code" href="group__cucul__attr.html#g8fbf26bd44f54caff1b1e22e7696ccd2">CUCUL_BLACK</a>,
                             <a class="code" href="group__cucul__attr.html#gce094d8bd1322912079b2d49351d83e9">CUCUL_WHITE</a>);
    <span class="comment">/* Draw a string at (0, 0) */</span>
    <a class="code" href="group__cucul__canvas.html#g722bd931689996265b368d42af0bef1f" title="Print a string.">cucul_put_str</a>(cv, 0, 0, <span class="stringliteral">"Hello world!"</span>);
    <span class="comment">/* Refresh display */</span>
    <a class="code" href="group__libcaca.html#g8c710eac721d05d807491a1534d1cbe7" title="Flush pending changes and redraw the screen.">caca_refresh_display</a>();
    <span class="comment">/* Wait for a key press event */</span>
    <a class="code" href="group__caca__event.html#g98e74dedbe1629c0fc9460761696e050" title="Get the next mouse or keyboard input event.">caca_get_event</a>(dp, <a class="code" href="caca_8h.html#40754185ca237fc44a95357afba34aeab1da825755a2ac3593cca73721b77e22">CACA_EVENT_KEY_PRESS</a>,
                   NULL, -1);
    <span class="comment">/* Clean up library */</span>
    <a class="code" href="group__libcaca.html#gc1b5b4540a500dd59eaa673d784fab1f" title="Detach a caca graphical context from a cucul backend context.">caca_free_display</a>(dp);

    <span class="keywordflow">return</span> 0;
}
</pre></div> </td></tr>
</table>
<p>
Note the following important things:<p>
<ul>
<li>Functions now take an object handle as their first argument.</li><li>All input/output functions start with <b>caca_</b> and all drawing and text handling functions start with <b>cucul_</b> .</li></ul>
<h2><a class="anchor" name="foo2">
Migration strategy</a></h2>
You have two ways to migrate your application to use <em>libcaca</em> 1.x:<p>
<ul>
<li>Port your code using the function equivalence list. This is the preferred way because new functions are thread safe and offer much more features to both the programmer and the end user.</li><li>Use the legacy compatibility layer.</li></ul>
<p>
Using the compatibility layer is as easy as adding the following three lines:<p>
<table border="0" cellspacing="3" cellpadding="3">
<tr>
<td valign="top"><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="caca_8h.html" title="The libcaca public header.">caca.h</a>&gt;</span>

<span class="comment">/* libcaca program - 0.x API */</span>
...
</pre></div> </td><td><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="caca_8h.html" title="The libcaca public header.">caca.h</a>&gt;</span>
<span class="preprocessor">#ifdef CACA_API_VERSION_1</span>
<span class="preprocessor"></span><span class="preprocessor">#   include &lt;caca0.h&gt;</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="comment">/* libcaca program - 0.x API */</span>
...
</pre></div> </td></tr>
</table>
<h2><a class="anchor" name="foo3">
Function equivalence list</a></h2>
<h3><a class="anchor" name="bar1">
Basic functions</a></h3>
<ul>
<li><b>caca_init()</b>: use <a class="el" href="group__libcucul.html#g6dcfc4c792b3bb77aaf0d4133654a2b4" title="Initialise a libcucul canvas.">cucul_create_canvas()</a> to create a <em>libcucul</em> canvas, followed by <a class="el" href="group__libcaca.html#g6128232026056ca5cd5905a745e9aaed" title="Attach a caca graphical context to a cucul canvas.">caca_create_display()</a> to attach a <em>libcaca</em> display to it.</li><li><b>caca_set_delay()</b>: use <a class="el" href="group__libcaca.html#g0340d64c3e7f23e11af749c4da83dfde" title="Set the refresh delay.">caca_set_display_time()</a>.</li><li><b>caca_get_feature()</b>: deprecated.</li><li><b>caca_set_feature()</b>: deprecated, see <a class="el" href="group__cucul__dither.html#gd904d926a115b0b8a8ef400e4180aa9e" title="Set dither antialiasing.">cucul_set_dither_antialias()</a>, <a class="el" href="group__cucul__dither.html#g14476c78dcb5183294bfe71fe9586a07" title="Choose colours used for dithering.">cucul_set_dither_color()</a> and cucul_set_dither_mode() instead.</li><li><b>caca_get_feature_name()</b>: deprecated, see cucul_get_dither_mode_list(), <a class="el" href="group__cucul__dither.html#gb10461cf1b2e633d04f165b5ed383a26" title="Get available antialiasing methods.">cucul_get_dither_antialias_list()</a> and <a class="el" href="group__cucul__dither.html#g23a49a94b047bd57baa22c5a0aa8b988" title="Get available colour modes.">cucul_get_dither_color_list()</a> instead.</li><li><b>caca_get_rendertime()</b>: use <a class="el" href="group__libcaca.html#g74339a36233beeee2ca5fe531885538a" title="Get the display&#39;s average rendering time.">caca_get_display_time()</a>.</li><li><b>caca_get_width()</b>: use <a class="el" href="group__libcucul.html#g0b6d866e23ef3492af7c4d8c5290012b" title="Get the canvas width.">cucul_get_canvas_width()</a>.</li><li><b>caca_get_height()</b>: use <a class="el" href="group__libcucul.html#g2517df334eb58617e030cd52cabf9e80" title="Get the canvas height.">cucul_get_canvas_height()</a>.</li><li><b>caca_set_window_title()</b>: use <a class="el" href="group__libcaca.html#gdab2bf1e8d0bf5c3cfb3e29ab07d5641" title="Set the display title.">caca_set_display_title()</a>.</li><li><b>caca_get_window_width()</b>: use <a class="el" href="group__libcaca.html#ge0cc5bc7835df240b242929cc77024ac" title="Get the display width.">caca_get_display_width()</a>.</li><li><b>caca_get_window_height()</b>: use <a class="el" href="group__libcaca.html#gf540716e9e5faa22a3dc5d0c68761a1f" title="Get the display height.">caca_get_display_height()</a>.</li><li><b>caca_refresh()</b>: use <a class="el" href="group__libcaca.html#g8c710eac721d05d807491a1534d1cbe7" title="Flush pending changes and redraw the screen.">caca_refresh_display()</a>.</li><li><b>caca_end()</b>: use <a class="el" href="group__libcaca.html#gc1b5b4540a500dd59eaa673d784fab1f" title="Detach a caca graphical context from a cucul backend context.">caca_free_display()</a> to detach the <em>libcaca</em> display, followed by <a class="el" href="group__libcucul.html#gdb9368348235e7ef4505108484005164" title="Uninitialise libcucul.">cucul_free_canvas()</a> to free the underlying <em>libcucul</em> canvas.</li></ul>
<h3><a class="anchor" name="bar2">
Event handling</a></h3>
<ul>
<li><b><a class="el" href="group__caca__event.html#g98e74dedbe1629c0fc9460761696e050" title="Get the next mouse or keyboard input event.">caca_get_event()</a></b>: unchanged, but the event information retrieval changed a lot.</li><li><b>caca_wait_event()</b>: use <a class="el" href="group__caca__event.html#g98e74dedbe1629c0fc9460761696e050" title="Get the next mouse or keyboard input event.">caca_get_event()</a> with a <code>timeout</code> argument of <b>-1</b>.</li><li><b><a class="el" href="group__caca__event.html#gf01ff2ff5f63e38eed2052b53181da2d" title="Return the X mouse coordinate.">caca_get_mouse_x()</a></b>: unchanged.</li><li><b><a class="el" href="group__caca__event.html#gc3310eaf44cc95e46be5c3e9a8a6818e" title="Return the Y mouse coordinate.">caca_get_mouse_y()</a></b>: unchanged.</li></ul>
<h3><a class="anchor" name="bar3">
Character printing</a></h3>
<ul>
<li><b>caca_set_color()</b>: use <a class="el" href="group__cucul__canvas.html#gd83c1d480f332db6db3ad249c5cb1749" title="Set the default colour pair for text (ANSI version).">cucul_set_color_ansi()</a> or <a class="el" href="group__cucul__canvas.html#gbf91cbadeb5e8979cddd088eebf3dad1" title="Set the default colour pair for text (truecolor version).">cucul_set_color_argb()</a>.</li><li><b>caca_get_fg_color()</b>: use <a class="el" href="group__cucul__canvas.html#g5a3b981664d0a7e7c1166657fda1cf6f" title="Get the text attribute at the given coordinates.">cucul_get_attr()</a>.</li><li><b>caca_get_bg_color()</b>: use <a class="el" href="group__cucul__canvas.html#g5a3b981664d0a7e7c1166657fda1cf6f" title="Get the text attribute at the given coordinates.">cucul_get_attr()</a>.</li><li><b>caca_get_color_name()</b>: this function is now deprecated due to major uselessness.</li><li><b>caca_putchar()</b>: use <a class="el" href="group__cucul__canvas.html#g4d4a4c792a2f29314cbf8d9f62d8fc40" title="Print an ASCII or Unicode character.">cucul_put_char()</a>.</li><li><b>caca_putstr()</b>: use <a class="el" href="group__cucul__canvas.html#g722bd931689996265b368d42af0bef1f" title="Print a string.">cucul_put_str()</a>.</li><li><b>caca_printf()</b>: use <a class="el" href="group__cucul__canvas.html#gc23ba3272299ddf7351d82e84d4c09df" title="Print a formated string.">cucul_printf()</a>.</li><li><b>caca_clear()</b>: use <a class="el" href="group__cucul__canvas.html#gc8e9f7631b2e3c7418eb5db0980407d9" title="Clear the canvas.">cucul_clear_canvas()</a>.</li></ul>
<h3><a class="anchor" name="bar4">
Primitives drawing</a></h3>
These functions are almost unchanged, except for Unicode support and the fact that they now act on a given canvas.<p>
<ul>
<li><b>caca_draw_line()</b>: use <a class="el" href="group__cucul__primitives.html#g5e6ab067e68804a50bdfa46354e7f49f" title="Draw a line on the canvas using the given character.">cucul_draw_line()</a>.</li><li><b>caca_draw_polyline()</b>: use <a class="el" href="group__cucul__primitives.html#ge22ea0e046c877f225d3da10e390105d" title="Draw a polyline.">cucul_draw_polyline()</a>.</li><li><b>caca_draw_thin_line()</b>: use <a class="el" href="group__cucul__primitives.html#gd0db3e395f08309d5b8e913880616137" title="Draw a thin line on the canvas, using ASCII art.">cucul_draw_thin_line()</a>.</li><li><b>caca_draw_thin_polyline()</b>: use <a class="el" href="group__cucul__primitives.html#gbab6e7ac982673166a175dd1e4bbae18" title="Draw an ASCII art thin polyline.">cucul_draw_thin_polyline()</a>.</li></ul>
<p>
<ul>
<li><b>caca_draw_circle()</b>: use <a class="el" href="group__cucul__primitives.html#ga5f542d110a15c047776a5ff9f668577" title="Draw a circle on the canvas using the given character.">cucul_draw_circle()</a>.</li><li><b>caca_draw_ellipse()</b>: use <a class="el" href="group__cucul__primitives.html#g10711c55628af18178226a1a11c211a6" title="Draw an ellipse on the canvas using the given character.">cucul_draw_ellipse()</a>.</li><li><b>caca_draw_thin_ellipse()</b>: use <a class="el" href="group__cucul__primitives.html#g026b236491ffc50a76eadd285d82042b" title="Draw a thin ellipse on the canvas.">cucul_draw_thin_ellipse()</a>.</li><li><b>caca_fill_ellipse()</b>: use <a class="el" href="group__cucul__primitives.html#gba32e675987ecea3f79253a4f92af5e6" title="Fill an ellipse on the canvas using the given character.">cucul_fill_ellipse()</a>.</li></ul>
<p>
<ul>
<li><b>caca_draw_box()</b>: use <a class="el" href="group__cucul__primitives.html#g6eea1222cadae739e9c826320a598c89" title="Draw a box on the canvas using the given character.">cucul_draw_box()</a>.</li><li><b>caca_draw_thin_box()</b>: use <a class="el" href="group__cucul__primitives.html#gabd57da6f0f155bbfb4f28b78804db7c" title="Draw a thin box on the canvas.">cucul_draw_thin_box()</a> or <a class="el" href="group__cucul__primitives.html#gaec847594e6606bd92995fa9a97e8ba4" title="Draw a box on the canvas using CP437 characters.">cucul_draw_cp437_box()</a>.</li><li><b>caca_fill_box()</b>: use <a class="el" href="group__cucul__primitives.html#g24c0e016b8c083afc225e291bac0b340" title="Fill a box on the canvas using the given character.">cucul_fill_box()</a>.</li></ul>
<p>
<ul>
<li><b>caca_draw_triangle()</b>: use <a class="el" href="group__cucul__primitives.html#ga97a76c3cf315af418aebb1b0ea38562" title="Draw a triangle on the canvas using the given character.">cucul_draw_triangle()</a>.</li><li><b>caca_draw_thin_triangle()</b>: use <a class="el" href="group__cucul__primitives.html#ge1db6b5f18812c1c187f306492fc98e6" title="Draw a thin triangle on the canvas.">cucul_draw_thin_triangle()</a>.</li><li><b>caca_fill_triangle()</b>: use <a class="el" href="group__cucul__primitives.html#ge84a38fe11a6b31d3d4dd82f4d76068e" title="Fill a triangle on the canvas using the given character.">cucul_fill_triangle()</a>.</li></ul>
<h3><a class="anchor" name="bar5">
Mathematical functions</a></h3>
<ul>
<li><b>caca_rand()</b>: use <a class="el" href="group__libcucul.html#g840da3c7684b44abc8ff634e293ad01c" title="Generate a random integer within a range.">cucul_rand()</a>. The second argument is different, make sure you take that into account.</li><li><b>caca_sqrt()</b>: this function is now deprecated, use your system's <b>sqrt()</b> call instead.</li></ul>
<h3><a class="anchor" name="bar6">
Sprite handling</a></h3>
The newly introduced canvases can have several frames. Sprites are hence completely deprecated.<p>
<ul>
<li><b>caca_load_sprite()</b>: use <a class="el" href="group__cucul__importexport.html#gf636e5d0308c6969725f0a3843f50697" title="Import a file into a canvas.">cucul_import_file()</a>.</li><li><b>caca_get_sprite_frames()</b>: use <a class="el" href="group__cucul__frame.html#g783ed3ffe7178a286be755cdf04a8b63" title="Get the number of frames in a canvas.">cucul_get_frame_count()</a>.</li><li><b>caca_get_sprite_width()</b>: use <a class="el" href="group__libcucul.html#g0b6d866e23ef3492af7c4d8c5290012b" title="Get the canvas width.">cucul_get_canvas_width()</a>.</li><li><b>caca_get_sprite_height()</b>: use <a class="el" href="group__libcucul.html#g2517df334eb58617e030cd52cabf9e80" title="Get the canvas height.">cucul_get_canvas_height()</a>.</li><li><b>caca_get_sprite_dx()</b>: use <a class="el" href="group__cucul__canvas.html#g2627613f9d88b27860f5a704af1d9100" title="Get X handle position.">cucul_get_canvas_handle_x()</a>.</li><li><b>caca_get_sprite_dy()</b>: use <a class="el" href="group__cucul__canvas.html#g0ce1c353b3079071cce3e01bbf6782cb" title="Get Y handle position.">cucul_get_canvas_handle_y()</a>.</li><li><b>caca_draw_sprite()</b>: use <a class="el" href="group__cucul__frame.html#g48b99193d551de1b7c918b35d2d5ef2a" title="Activate a given canvas frame.">cucul_set_frame()</a> and <a class="el" href="group__cucul__canvas.html#gfc47e22f0b9284096bfdeaeb17a8fb8d" title="Blit a canvas onto another one.">cucul_blit()</a>.</li><li><b>caca_free_sprite()</b>: use <a class="el" href="group__libcucul.html#gdb9368348235e7ef4505108484005164" title="Uninitialise libcucul.">cucul_free_canvas()</a>.</li></ul>
<h3><a class="anchor" name="bar7">
Bitmap handling</a></h3>
Bitmaps have been renamed to dithers, because these objects do not in fact store any pixels, they just have information on how bitmaps will be dithered.<p>
<ul>
<li><b>caca_create_bitmap()</b>: use <a class="el" href="group__cucul__dither.html#g39c09f76c2b040c5e3914e9f93e091b2" title="Create an internal dither object.">cucul_create_dither()</a>.</li><li><b>caca_set_bitmap_palette()</b>: use <a class="el" href="group__cucul__dither.html#g1b4c790bd44f310fe652336c29dab57d" title="Set the palette of an 8bpp dither object.">cucul_set_dither_palette()</a>.</li><li><b>caca_draw_bitmap()</b>: use <a class="el" href="group__cucul__dither.html#g3ad39209ee17ef59a0804bddde8c1a1b" title="Dither a bitmap on the canvas.">cucul_dither_bitmap()</a>.</li><li><b>caca_free_bitmap()</b>: use <a class="el" href="group__cucul__dither.html#g0461a5b78e6bf0ccbea0799e22cf139b" title="Free the memory associated with a dither.">cucul_free_dither()</a>.</li></ul>
<h2><a class="anchor" name="foo4">
Compilation</a></h2>
The <code>caca-config</code> utility is deprecated in favour of the standard <code>pkg-config</code> interface:<p>
<div class="fragment"><pre class="fragment">gcc -c foobar.c -o foobar.o `pkg-config --cflags caca`
gcc foobar.o -o foobar `pkg-config --libs caca`
</pre></div><p>
<code>caca-config</code> is still provided as a convenience tool but may be removed in the future. </div>
<!-- $Id$ -->
  </body>
</html>
